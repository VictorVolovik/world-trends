const SAMPLE_CHARTS_DATA = {
  "Aug, 24": [
    {
      name: "Chart 1",
      color: "#af3127",
      data: [
        { date: "1 Aug", usage: 0 },
        { date: "2 Aug", usage: 0.51 },
        { date: "3 Aug", usage: 0.652 },
        { date: "4 Aug", usage: 0.6 },
        { date: "5 Aug", usage: 0.62 },
        { date: "6 Aug", usage: 0.68 },
        { date: "7 Aug", usage: 0.75 },
        { date: "8 Aug", usage: 0.67 },
        { date: "9 Aug", usage: 0.7 },
        { date: "10 Aug", usage: 0.73 },
        { date: "11 Aug", usage: 0.71 },
        { date: "12 Aug", usage: 0.69 },
        { date: "13 Aug", usage: 0.72 },
        { date: "14 Aug", usage: 0.74 },
        { date: "15 Aug", usage: 0.765 },
        { date: "16 Aug", usage: 0.78 },
        { date: "17 Aug", usage: 0.8 },
        { date: "18 Aug", usage: 0.82 },
        { date: "19 Aug", usage: 0.79 },
        { date: "20 Aug", usage: 0.77 },
        { date: "21 Aug", usage: 0.75 },
        { date: "22 Aug", usage: 0.74 },
        { date: "23 Aug", usage: 0.73 },
        { date: "24 Aug", usage: 0.71 },
        { date: "25 Aug", usage: 0.7 },
        { date: "26 Aug", usage: 0.68 },
        { date: "27 Aug", usage: 0.67 },
        { date: "28 Aug", usage: 0.65 },
        { date: "29 Aug", usage: 0.63 },
        { date: "30 Aug", usage: 0.61 },
        { date: "31 Aug", usage: 0.59 },
      ],
    },
    {
      name: "Chart 2",
      color: "#203d91",
      data: [
        { date: "1 Aug", usage: 0 },
        { date: "2 Aug", usage: 0.3 },
        { date: "3 Aug", usage: 0.223 },
        { date: "4 Aug", usage: 0.35 },
        { date: "5 Aug", usage: 0.41 },
        { date: "6 Aug", usage: 0.33 },
        { date: "7 Aug", usage: 0.39 },
        { date: "8 Aug", usage: 0.36 },
        { date: "9 Aug", usage: 0.38 },
        { date: "10 Aug", usage: 0.4 },
        { date: "11 Aug", usage: 0.41 },
        { date: "12 Aug", usage: 0.42 },
        { date: "13 Aug", usage: 0.44 },
        { date: "14 Aug", usage: 0.46 },
        { date: "15 Aug", usage: 0.47 },
        { date: "16 Aug", usage: 0.48 },
        { date: "17 Aug", usage: 0.5 },
        { date: "18 Aug", usage: 0.51 },
        { date: "19 Aug", usage: 0.53 },
        { date: "20 Aug", usage: 0.55 },
        { date: "21 Aug", usage: 0.57 },
        { date: "22 Aug", usage: 0.59 },
        { date: "23 Aug", usage: 0.61 },
        { date: "24 Aug", usage: 0.63 },
        { date: "25 Aug", usage: 0.65 },
        { date: "26 Aug", usage: 0.67 },
        { date: "27 Aug", usage: 0.69 },
        { date: "28 Aug", usage: 0.71 },
        { date: "29 Aug", usage: 0.73 },
        { date: "30 Aug", usage: 0.75 },
        { date: "31 Aug", usage: 0.77 },
      ],
    },
  ],
  "Sep, 24": [
    {
      name: "Chart 1",
      color: "#af3127",
      data: [
        { date: "1 Sep", usage: 0 },
        { date: "2 Sep", usage: 0.45 },
        { date: "3 Sep", usage: 0.5 },
        { date: "4 Sep", usage: 0.55 },
        { date: "5 Sep", usage: 0.6 },
        { date: "6 Sep", usage: 0.65 },
        { date: "7 Sep", usage: 0.7 },
        { date: "8 Sep", usage: 0.68 },
        { date: "9 Sep", usage: 0.72 },
        { date: "10 Sep", usage: 0.75 },
        { date: "11 Sep", usage: 0.74 },
        { date: "12 Sep", usage: 0.73 },
        { date: "13 Sep", usage: 0.76 },
        { date: "14 Sep", usage: 0.78 },
        { date: "15 Sep", usage: 0.8 },
        { date: "16 Sep", usage: 0.82 },
        { date: "17 Sep", usage: 0.81 },
        { date: "18 Sep", usage: 0.79 },
        { date: "19 Sep", usage: 0.77 },
        { date: "20 Sep", usage: 0.75 },
        { date: "21 Sep", usage: 0.73 },
        { date: "22 Sep", usage: 0.71 },
        { date: "23 Sep", usage: 0.69 },
        { date: "24 Sep", usage: 0.67 },
        { date: "25 Sep", usage: 0.65 },
        { date: "26 Sep", usage: 0.63 },
        { date: "27 Sep", usage: 0.61 },
        { date: "28 Sep", usage: 0.59 },
        { date: "29 Sep", usage: 0.57 },
        { date: "30 Sep", usage: 0.55 },
      ],
    },
    {
      name: "Chart 2",
      color: "#203d91",
      data: [
        { date: "1 Sep", usage: 0 },
        { date: "2 Sep", usage: 0.3 },
        { date: "3 Sep", usage: 0.35 },
        { date: "4 Sep", usage: 0.4 },
        { date: "5 Sep", usage: 0.45 },
        { date: "6 Sep", usage: 0.5 },
        { date: "7 Sep", usage: 0.55 },
        { date: "8 Sep", usage: 0.6 },
        { date: "9 Sep", usage: 0.65 },
        { date: "10 Sep", usage: 0.7 },
        { date: "11 Sep", usage: 0.72 },
        { date: "12 Sep", usage: 0.74 },
        { date: "13 Sep", usage: 0.76 },
        { date: "14 Sep", usage: 0.78 },
        { date: "15 Sep", usage: 0.8 },
        { date: "16 Sep", usage: 0.82 },
        { date: "17 Sep", usage: 0.81 },
        { date: "18 Sep", usage: 0.79 },
        { date: "19 Sep", usage: 0.77 },
        { date: "20 Sep", usage: 0.75 },
        { date: "21 Sep", usage: 0.73 },
        { date: "22 Sep", usage: 0.71 },
        { date: "23 Sep", usage: 0.69 },
        { date: "24 Sep", usage: 0.67 },
        { date: "25 Sep", usage: 0.65 },
        { date: "26 Sep", usage: 0.63 },
        { date: "27 Sep", usage: 0.61 },
        { date: "28 Sep", usage: 0.59 },
        { date: "29 Sep", usage: 0.57 },
        { date: "30 Sep", usage: 0.55 },
      ],
    },
  ],
  "Oct, 24": [
    {
      name: "Chart 1",
      color: "#af3127",
      data: [
        { date: "1 Oct", usage: 0 },
        { date: "2 Oct", usage: 0.4 },
        { date: "3 Oct", usage: 0.45 },
        { date: "4 Oct", usage: 0.5 },
        { date: "5 Oct", usage: 0.55 },
        { date: "6 Oct", usage: 0.6 },
        { date: "7 Oct", usage: 0.65 },
        { date: "8 Oct", usage: 0.7 },
        { date: "9 Oct", usage: 0.72 },
        { date: "10 Oct", usage: 0.74 },
        { date: "11 Oct", usage: 0.76 },
        { date: "12 Oct", usage: 0.78 },
        { date: "13 Oct", usage: 0.8 },
        { date: "14 Oct", usage: 0.82 },
        { date: "15 Oct", usage: 0.81 },
        { date: "16 Oct", usage: 0.79 },
        { date: "17 Oct", usage: 0.77 },
        { date: "18 Oct", usage: 0.75 },
        { date: "19 Oct", usage: 0.73 },
        { date: "20 Oct", usage: 0.71 },
        { date: "21 Oct", usage: 0.69 },
        { date: "22 Oct", usage: 0.67 },
        { date: "23 Oct", usage: 0.65 },
        { date: "24 Oct", usage: 0.63 },
        { date: "25 Oct", usage: 0.61 },
        { date: "26 Oct", usage: 0.59 },
        { date: "27 Oct", usage: 0.57 },
        { date: "28 Oct", usage: 0.55 },
        { date: "29 Oct", usage: 0.53 },
        { date: "30 Oct", usage: 0.51 },
        { date: "31 Oct", usage: 0.49 },
      ],
    },
    {
      name: "Chart 2",
      color: "#203d91",
      data: [
        { date: "1 Oct", usage: 0 },
        { date: "2 Oct", usage: 0.35 },
        { date: "3 Oct", usage: 0.4 },
        { date: "4 Oct", usage: 0.45 },
        { date: "5 Oct", usage: 0.5 },
        { date: "6 Oct", usage: 0.55 },
        { date: "7 Oct", usage: 0.6 },
        { date: "8 Oct", usage: 0.65 },
        { date: "9 Oct", usage: 0.7 },
        { date: "10 Oct", usage: 0.72 },
        { date: "11 Oct", usage: 0.74 },
        { date: "12 Oct", usage: 0.76 },
        { date: "13 Oct", usage: 0.78 },
        { date: "14 Oct", usage: 0.8 },
        { date: "15 Oct", usage: 0.82 },
        { date: "16 Oct", usage: 0.81 },
        { date: "17 Oct", usage: 0.79 },
        { date: "18 Oct", usage: 0.77 },
        { date: "19 Oct", usage: 0.75 },
        { date: "20 Oct", usage: 0.73 },
        { date: "21 Oct", usage: 0.71 },
        { date: "22 Oct", usage: 0.69 },
        { date: "23 Oct", usage: 0.67 },
        { date: "24 Oct", usage: 0.65 },
        { date: "25 Oct", usage: 0.63 },
        { date: "26 Oct", usage: 0.61 },
        { date: "27 Oct", usage: 0.59 },
        { date: "28 Oct", usage: 0.57 },
        { date: "29 Oct", usage: 0.55 },
        { date: "30 Oct", usage: 0.53 },
        { date: "31 Oct", usage: 0.51 },
      ],
    },
  ],
  "Nov, 24": [
    {
      name: "Chart 1",
      color: "#af3127",
      data: [
        { date: "1 Nov", usage: 0 },
        { date: "2 Nov", usage: 0.3 },
        { date: "3 Nov", usage: 0.35 },
        { date: "4 Nov", usage: 0.4 },
        { date: "5 Nov", usage: 0.45 },
        { date: "6 Nov", usage: 0.5 },
        { date: "7 Nov", usage: 0.55 },
        { date: "8 Nov", usage: 0.6 },
        { date: "9 Nov", usage: 0.65 },
        { date: "10 Nov", usage: 0.7 },
        { date: "11 Nov", usage: 0.72 },
        { date: "12 Nov", usage: 0.74 },
        { date: "13 Nov", usage: 0.76 },
        { date: "14 Nov", usage: 0.78 },
        { date: "15 Nov", usage: 0.8 },
        { date: "16 Nov", usage: 0.82 },
        { date: "17 Nov", usage: 0.81 },
        { date: "18 Nov", usage: 0.79 },
        { date: "19 Nov", usage: 0.77 },
        { date: "20 Nov", usage: 0.75 },
        { date: "21 Nov", usage: 0.73 },
        { date: "22 Nov", usage: 0.71 },
        { date: "23 Nov", usage: 0.69 },
        { date: "24 Nov", usage: 0.67 },
        { date: "25 Nov", usage: 0.65 },
        { date: "26 Nov", usage: 0.63 },
        { date: "27 Nov", usage: 0.61 },
        { date: "28 Nov", usage: 0.59 },
        { date: "29 Nov", usage: 0.57 },
        { date: "30 Nov", usage: 0.55 },
      ],
    },
    {
      name: "Chart 2",
      color: "#203d91",
      data: [
        { date: "1 Nov", usage: 0 },
        { date: "2 Nov", usage: 0.25 },
        { date: "3 Nov", usage: 0.3 },
        { date: "4 Nov", usage: 0.35 },
        { date: "5 Nov", usage: 0.4 },
        { date: "6 Nov", usage: 0.45 },
        { date: "7 Nov", usage: 0.5 },
        { date: "8 Nov", usage: 0.55 },
        { date: "9 Nov", usage: 0.6 },
        { date: "10 Nov", usage: 0.65 },
        { date: "11 Nov", usage: 0.7 },
        { date: "12 Nov", usage: 0.72 },
        { date: "13 Nov", usage: 0.74 },
        { date: "14 Nov", usage: 0.76 },
        { date: "15 Nov", usage: 0.78 },
        { date: "16 Nov", usage: 0.8 },
        { date: "17 Nov", usage: 0.82 },
        { date: "18 Nov", usage: 0.81 },
        { date: "19 Nov", usage: 0.79 },
        { date: "20 Nov", usage: 0.77 },
        { date: "21 Nov", usage: 0.75 },
        { date: "22 Nov", usage: 0.73 },
        { date: "23 Nov", usage: 0.71 },
        { date: "24 Nov", usage: 0.69 },
        { date: "25 Nov", usage: 0.67 },
        { date: "26 Nov", usage: 0.65 },
        { date: "27 Nov", usage: 0.63 },
        { date: "28 Nov", usage: 0.61 },
        { date: "29 Nov", usage: 0.59 },
        { date: "30 Nov", usage: 0.57 },
      ],
    },
  ],
  "Dec, 24": [
    {
      name: "Chart 1",
      color: "#af3127",
      data: [
        { date: "1 Dec", usage: 0 },
        { date: "2 Dec", usage: 0.2 },
        { date: "3 Dec", usage: 0.25 },
        { date: "4 Dec", usage: 0.3 },
        { date: "5 Dec", usage: 0.35 },
        { date: "6 Dec", usage: 0.4 },
        { date: "7 Dec", usage: 0.45 },
        { date: "8 Dec", usage: 0.5 },
        { date: "9 Dec", usage: 0.55 },
        { date: "10 Dec", usage: 0.6 },
        { date: "11 Dec", usage: 0.65 },
        { date: "12 Dec", usage: 0.7 },
        { date: "13 Dec", usage: 0.72 },
        { date: "14 Dec", usage: 0.74 },
        { date: "15 Dec", usage: 0.76 },
        { date: "16 Dec", usage: 0.78 },
        { date: "17 Dec", usage: 0.8 },
        { date: "18 Dec", usage: 0.82 },
        { date: "19 Dec", usage: 0.81 },
        { date: "20 Dec", usage: 0.79 },
        { date: "21 Dec", usage: 0.77 },
        { date: "22 Dec", usage: 0.75 },
        { date: "23 Dec", usage: 0.73 },
        { date: "24 Dec", usage: 0.71 },
        { date: "25 Dec", usage: 0.69 },
        { date: "26 Dec", usage: 0.67 },
        { date: "27 Dec", usage: 0.65 },
        { date: "28 Dec", usage: 0.63 },
        { date: "29 Dec", usage: 0.61 },
        { date: "30 Dec", usage: 0.59 },
        { date: "31 Dec", usage: 0.57 },
      ],
    },
    {
      name: "Chart 2",
      color: "#203d91",
      data: [
        { date: "1 Dec", usage: 0 },
        { date: "2 Dec", usage: 0.15 },
        { date: "3 Dec", usage: 0.2 },
        { date: "4 Dec", usage: 0.25 },
        { date: "5 Dec", usage: 0.3 },
        { date: "6 Dec", usage: 0.35 },
        { date: "7 Dec", usage: 0.4 },
        { date: "8 Dec", usage: 0.45 },
        { date: "9 Dec", usage: 0.5 },
        { date: "10 Dec", usage: 0.55 },
        { date: "11 Dec", usage: 0.6 },
        { date: "12 Dec", usage: 0.65 },
        { date: "13 Dec", usage: 0.7 },
        { date: "14 Dec", usage: 0.72 },
        { date: "15 Dec", usage: 0.74 },
        { date: "16 Dec", usage: 0.76 },
        { date: "17 Dec", usage: 0.78 },
        { date: "18 Dec", usage: 0.8 },
        { date: "19 Dec", usage: 0.82 },
        { date: "20 Dec", usage: 0.81 },
        { date: "21 Dec", usage: 0.79 },
        { date: "22 Dec", usage: 0.77 },
        { date: "23 Dec", usage: 0.75 },
        { date: "24 Dec", usage: 0.73 },
        { date: "25 Dec", usage: 0.71 },
        { date: "26 Dec", usage: 0.69 },
        { date: "27 Dec", usage: 0.67 },
        { date: "28 Dec", usage: 0.65 },
        { date: "29 Dec", usage: 0.63 },
        { date: "30 Dec", usage: 0.61 },
        { date: "31 Dec", usage: 0.59 },
      ],
    },
  ],
};

async function fakeGetChartsData() {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve({
        ok: true,
        json: async () => SAMPLE_CHARTS_DATA,
      });
    }, 1000);
  });
}

function renderSelectors(charts) {
  const selectors = document.querySelector(".chart-selectors");
  selectors.innerHTML = "";

  const fragment = document.createDocumentFragment();

  Object.keys(charts).forEach((key, idx) => {
    const selector = document.createElement("button");
    selector.classList.add("chart-selectors__item", "focusable");
    selector.setAttribute("data-selector", key);
    selector.textContent = key;
    if (idx === 0) {
      selector.classList.add("chart-selectors__item--active");
    }
    fragment.appendChild(selector);
  });

  selectors.appendChild(fragment);

  selectors.addEventListener("click", function handleSelectorsClick(e) {
    if (e.target.matches(".chart-selectors__item")) {
      const month = e.target.dataset.selector;
      Array.from(selectors.children).forEach((child) => {
        child.classList.remove("chart-selectors__item--active");
      });
      e.target.classList.add("chart-selectors__item--active");
      renderCharts(charts[month]);
    }
  });
}

function renderCharts(charts) {
  const chartsEl = document.querySelector(".chart-block");
  const myChart = echarts.init(chartsEl);

  const xAxisData = charts[0].data.map((point) => point.date);

  const seriesData = charts.map((chart) => ({
    name: chart.name,
    type: "line",
    data: chart.data.map((point) => point.usage),
    color: chart.color,
    label: {
      show: false,
      position: "top",
      formatter: "{c} GB",
    },
    emphasis: {
      label: {
        show: true,
      },
    },
  }));

  const option = {
    tooltip: {
      trigger: "axis",
    },
    xAxis: {
      type: "category",
      data: xAxisData,
    },
    yAxis: {
      type: "value",
      axisLabel: {
        formatter: "{value}",
      },
    },
    series: seriesData,
  };

  myChart.setOption(option);

  window.addEventListener("resize", function () {
    myChart.resize();
  });
}

async function getChartsData() {
  try {
    const chartsData = await fakeGetChartsData();
    if (!chartsData.ok) throw new Error("Failed to fetch charts data");

    const charts = await chartsData.json();
    renderSelectors(charts);
    const firstMonthData = Object.values(charts)[0];
    renderCharts(firstMonthData);
  } catch (err) {
    console.error("Error fetching charts data:", err);
  }
}

function main() {
  getChartsData();
}

document.addEventListener("DOMContentLoaded", function () {
  main();
});
